<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>fingis vignette &mdash; rOpenGov</title>
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans:400,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/assets/main.css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet" />
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="/images/logo.png"/>
  <link href="/feed.xml" rel="alternate" type="application/rss+xml" title="rOpenGov" />
  <meta name="title" content="fingis vignette ">
  <link rel="canonical" href="http://ropengov.github.io/tutorials/fingis_tutorial.Rmd">
   
         
  <meta property="og:title" content="fingis vignette "/>
  <meta property="og:url" content="http://ropengov.github.io/tutorials/fingis_tutorial.Rmd"/>
  
  
  <meta property="og:site_name" content="rOpenGov">     
</head>
<body>
  
  <section class="site-nav">
  <header>
      <nav id="navigation">
          <a class="brand" href="/">
              <img src="/images/logo.png" alt="rOpenGov">
          </a>
          <a href="/" class="home">Blog</a>
          
          <a href="http://ropengov.github.io/projects">Projects</a>
          <a href="http://ropengov.github.io/about">About</a>
          <a href="http://ropengov.github.io/contribute">Contribute</a>          
      </nav>
      
  </header>
  </section>

  <article class="container">

  <div class="span11">
  <div class="row">

  <header class="jumbotron subhead" id="overview"> 
     <iframe src="http://ghbtns.com/github-btn.html?user=ropengov&repo=fingis&type=watch&count=true&size=large" allowtransparency="true" frameborder="0" scrolling="0" width="170" height="30" align="right"></iframe>
     <iframe src="http://ghbtns.com/github-btn.html?user=ropengov&repo=fingis&type=fork&count=true&size=large" allowtransparency="true" frameborder="0" scrolling="0" width="170" height="30" align="right"></iframe>      

     <h1> <i class="fa fa-book"></i>  fingis <small>v0.9.9</small> </h1>
  </header>
    
  </div>
  <!-- <br> -->

  <div class"row"> <h2> <em> R tools for reading open geographical data in Finland. </em> </h2>

  <!-- <h3><i class="ss-icon" style="color:#ebeef6;">&#x2139;</i>&nbsp;&nbsp;This is the vignette in the fingis package</h3> -->
  <br>

  <center><a href="https://github.com/ropengov/fingis/" style="color:#ffffff" target="_blank"> <button class="btn btn-success btn-large" style="display: block; width: 75%;"><i class="icon-white icon-download"></i>Download from GitHub</button></a></center>
  <br>
  <!-- <hr class="soften"> -->
  </div>
  <div class="span11">
  ```{r setup, echo=FALSE}
opts_knit$set(upload.fun = imgur_upload, base.url = NULL) # upload all images to imgur.com
# opts_chunk$set(fig.width=5, fig.height=5, cache=TRUE)
```

Finland GIS R tools
===========

This is an [rOpenGov](https://github.com/rOpenGov/fingis) R package
providing tools for Finnish GIS data.

## Available data

The following data sets are currently available:
* [Helsinki region aluejakokartat](#helsinki-region-aluejakokartat)
* [Helsinki spatial data](#helsinki-spatial-data)
* [Maanmittauslaitos](#maanmittauslaitos)
* [Geocoding](#geocoding)

### Installation

Note! The fingis package uses the [rgdal](http://cran.r-project.org/web/packages/rgdal/index.html) library, which depends on the [GDAL](http://www.gdal.org/) spatial framework. Some rgdal installation tips for various platforms lister below. If you encounter problems, please contact us by email: louhos@googlegroups.com.
* Windows: Install binaries from [CRAN](http://cran.r-project.org/web/packages/rgdal/index.html)
* OSX: Install binaries from [CRAN](http://cran.r-project.org/web/packages/rgdal/index.html). Check also [KyngChaos Wiki](http://www.kyngchaos.com/software/frameworks) 
* Linux: Try the installation scripts [here](https://github.com/louhos/takomo/tree/master/installation/) (not necessarily up-to-date!)


Release version for general users (NOT AVAILABLE YET):

Development version for developers:

```{r install2, eval=FALSE}
install.packages("devtools")
library(devtools)
install_github("fingis", "ropengov")
```

Load package.

```{r load}
library(fingis)
```

Further development instructions at the [Github
page](https://github.com/rOpenGov/fingis).

### Helsinki region aluejakokartat

Helsinki region aluejakokartat (district maps) from [HKK](http://ptp.hel.fi/avoindata/).

List available maps with `get_Helsinki_aluejakokartat()`.

```{r aluejako_list, message=FALSE}
get_Helsinki_aluejakokartat()
```

Retrieve 'suuralue' spatial object with `get_Helsinki_aluejakokartat()`, and plot with `plot_shape()`.

```{r hkk-suuralue1, message=FALSE, warning=FALSE, results='hide'}
sp.suuralue <- get_Helsinki_aluejakokartat(map.specifier="suuralue")
plot_shape(sp=sp.suuralue, varname="Name", type="discrete", plot=FALSE)
```

Retrieve 'suuralue_piste' spatial object, containing the center points of the districts, and plot with `spplot()`.

```{r hkk-suuralue2, message=FALSE, warning=FALSE, results='hide'}
sp.suuralue.piste <- get_Helsinki_aluejakokartat(map.specifier="suuralue_piste")
sp::spplot(obj=sp.suuralue.piste, zcol="Name")
```

Use `sp2df()` function to tranform the spatial objects into data frames. Plot with [ggplot2](http://ggplot2.org/), using blank map theme with `get_theme_map()`. 

```{r hkk-suuralue3, message=FALSE}
# Get data frames
df.suuralue <- sp2df(sp.suuralue, "Name")
df.suuralue.piste <- sp2df(sp.suuralue.piste, "Name")

# Set map theme
library(ggplot2)
theme_set(get_theme_map())
# Plot regions, add labels using the points data
ggplot(df.suuralue, aes(x=long, y=lat, fill=Name)) + geom_polygon() + geom_text(data=df.suuralue.piste, aes(label=Name)) + theme(legend.position="none")
```

Add background map from OpenStreetMap using `get_map()` from [ggmap](https://sites.google.com/site/davidkahle/ggmap) and plot again.

```{r hkk-suuralue4, message=FALSE}
# Add background map from OpenStreetMap using ggmap
library(ggmap)
# Get bounding box from sp.suuralue
hel.bbox <- as.vector(sp.suuralue@bbox)
# Get map using openstreetmap
hel.map <- ggmap::get_map(location=hel.bbox, source="osm")
# Plot transparent districts on top the background map
ggmap(hel.map) + geom_polygon(data=df.suuralue, aes(x=long, y=lat, fill=Name), alpha=0.5) + geom_text(data=df.suuralue.piste, aes(x=long, y=lat, label=Name)) + theme(legend.position="none")
```

Retrieve and plot äänetysaluejako (election districts) with `get_Helsinki_aluejakokartat()` and `plot_shape()`.

```{r hkk-aanestysalue, message=FALSE, warning=FALSE, results='hide'}
sp.aanestys <- get_Helsinki_aluejakokartat(map.specifier="aanestysalue")
plot_shape(sp.aanestys, "KUNTA", type="discrete", plot=FALSE)
```

### Helsinki spatial data

Other Helsinki region spatial data from [HKK](http://ptp.hel.fi/avoindata/).

List available spatial data with `get_Helsinki_spatial()`.

```{r hki_spatial_list, message=FALSE}
get_Helsinki_spatial()
```


### Maanmittauslaitos

Spatial data from  Maanmittauslaitos (MML, Land Survey Finland). These data are preprocessed into RData format, see details [here](https://github.com/avoindata/mml/tree/master/rdata).

List available data sets with `list_mml_datasets()`.

```{r MML_list, message=FALSE} 
list_mml_datasets()
```

Retrieve regional borders for Finland with `get_MML()`.

```{r MML_regions, message=FALSE, warning=FALSE} 
# Get a specific map
sp.mml <- get_MML(map.id="Yleiskartta-4500", data.id="HallintoAlue") 

# Investigate available variables in this map
head(as.data.frame(sp.mml))
```

Plot provinces (maakunnat) with `plot_shape()`.

```{r MML_province, message=FALSE, warning=FALSE} 
# Plot the shape file, colour provinces
plot_shape(sp=sp.mml, varname="Maakunta", type="discrete", plot = FALSE)
```

Plot municipalities (kunnat) with `plot_shape()`.

```{r MML_municipality, message=FALSE, warning=FALSE} 
# Plot the shape file, colour municipalities
plot_shape(sp=sp.mml, varname="Kunta", type="discrete", plot = FALSE)
```

### Geocoding

Get geocodes for given location (address etc.) using one of the available services. Please read carefully the usage policies for the different services:
* [OKF.fi Geocoding API Test Console](http://data.okf.fi/console/)
* [OpenStreetMap Nominatim](http://wiki.openstreetmap.org/wiki/Nominatim_usage_policy)
* [Google](http://code.google.com/apis/maps/documentation/geocoding/)

The function `get_geocode()` returns both latitude and longitude for the first hit, and the raw output (varies depending on the service used).

```{r geocoding, message=FALSE}
gc1 <- get_geocode("Mannerheimintie 100, Helsinki", service="okf")
unlist(gc1[1:2])
gc2 <- get_geocode("Mannerheimintie 100, Helsinki", service="openstreetmap")
unlist(gc2[1:2])
gc3 <- get_geocode("Mannerheimintie 100, Helsinki", service="google")
unlist(gc3[1:2])
```

### Licensing and Citations

This work can be freely used, modified and distributed under the
[Two-clause FreeBSD
license](http://en.wikipedia.org/wiki/BSD\_licenses). Cite this R
package and and the appropriate data provider, including a url
link. Kindly cite the R package as 'Leo Lahti, Juuso Parkkinen ja
Joona Lehtomäki (2014). fingis R package. URL:
https://github.com/rOpenGov/fingis'.


### Session info


This vignette was created with

```{r sessioninfo, message=FALSE, warning=FALSE}
sessionInfo()
```


  </div>

  </article>

  <footer class="site-footer">
      <div class="container">
          &copy; 2014 
          
          <nav>
              <a href="http://ropengov.github.io/">rOpenGov</a> &middot;
              <a href="/">Blog</a> &middot;
              
              
          </nav>
          
          <nav class="social">
              
              <a href="https://twitter.com/ropengov" title="Follow on Twitter" target="_blank"><i class="icon icon-twitter black"></i></a>
              
                  
              <a href="/feed.xml" title="RSS Feed">
                  <i class="icon icon-rss black"></i>
              </a>
          </nav>
          <p>Incorporated theme by <a href="https://sendtoinc.com">Inc</a></p>
      </div>
  </footer>

  <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="/assets/main.js"></script>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=253595308025739";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
<script>
    (function(d, t) {
        var g = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        g.src = '//hnbutton.appspot.com/static/hn.min.js';
        s.parentNode.insertBefore(g, s);
    }(document, 'script'));
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44262937-1', 'http://ropengov.github.io');
  ga('send', 'pageview');
</script>

  </body>
</html>